<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Iframe Test</title>
  <style>
    iframe {
      width: 690px;
      height: 30rem;
      border: none;
      -ms-zoom: 1.25;
      -moz-transform: scale(1.25);
      -moz-transform-origin: 0 0;
      -o-transform: scale(1.25);
      -o-transform-origin: 0 0;
      -webkit-transform: scale(1.25);
      -webkit-transform-origin: 0 0;
    }
  </style>
</head>
<body>
  <iframe src="http://localhost:3000" id="code-sandbox" onload="sendQuestion()"></iframe>
  <script>
      const functionName = "square",
          question = "Create a function `square` that takes a parameter `x` and returns its square.",
          intiCode = "def square(x):\n  # Your code here",
          tests = [[3], [5], [0], [-2]],
          correct = [9, 25, 0, 4];

      function sendPostMessage(obj) {
          const sandbox = document.getElementById("code-sandbox");
          sandbox.contentWindow.postMessage(obj, "*");
      }

      function sendQuestion() {
          sendPostMessage({
              // question: question,
              code: intiCode,
              // tests: tests,
              // functionName: functionName
          });
      }

      window.addEventListener('message', e => {
          let success = true;
          let message = "Congrats! You passed the test.";
          for (let i = 0; i < correct.length; i++) {
              if(e.data[i] !== correct[i]) {
                  message = `"square(${tests[i][0]})" returns ${e.data[[i]]} instead of ${correct[i]}!`;
                  success = false;
                  break;
              }
          }
          sendPostMessage({
              success: success,
              message: message
          });
      });
  </script>
</body>
</html>